# 为文章编辑器添加语法高亮支持

根据用户反馈，文章编辑器的预览模式目前不支持代码高亮。我需要更新 `Editor.vue` 中的 `marked` 配置，以启用 `highlight.js`。

## 问题分析
在 `src/views/Editor.vue` 中，虽然已经引入了 `highlight.js` 和其样式，并且配置了 `marked` 的 `highlight` 选项，但 `marked` 的新版本（v4+ 或 v5+）对异步高亮和同步高亮的处理方式有所变化。

当前代码：
```javascript
marked.setOptions({
  highlight: function(code, lang) {
    if (lang && hljs.getLanguage(lang)) {
      return hljs.highlight(code, { language: lang }).value
    }
    return hljs.highlightAuto(code).value
  }
})
```

`marked.parse` 是同步调用的。然而，有时候仅仅返回高亮后的 HTML 字符串是不够的，还需要确保 CSS 样式被正确加载。更重要的是，在 `marked` v5+ 中，推荐使用 `marked-highlight` 扩展，或者确保 `highlight` 函数返回的是同步结果。

经过检查，当前的代码逻辑看起来是正确的同步高亮。**但是**，可能存在以下原因导致高亮未生效：
1.  **CSS 样式未生效**：`import 'highlight.js/styles/atom-one-dark.css'` 可能被其他样式覆盖，或者 `marked` 生成的 HTML 类名（如 `language-js`）没有正确匹配。`highlight.js` 生成的类名通常带有 `hljs` 前缀。
2.  **Marked 配置问题**：在较新版本的 `marked` 中，`highlight` 选项可能需要配合 `langPrefix: 'hljs language-'` 使用，以确保生成的 `<code class="...">` 包含 `hljs` 类名，从而应用样式。

## 修复计划

1.  **更新 `marked` 配置**：
    *   添加 `langPrefix: 'hljs language-'` 选项。这是关键，因为 `highlight.js` 的 CSS 样式是基于 `.hljs` 选择器的。如果不加这个前缀，生成的代码块可能只有 `language-js` 类，导致样式无法应用。
2.  **验证 `highlight.js` 调用**：确保 `hljs.highlight` 调用参数正确。

## 修改 `src/views/Editor.vue`

```javascript
// ...
marked.setOptions({
  highlight: function(code, lang) {
    if (lang && hljs.getLanguage(lang)) {
      return hljs.highlight(code, { language: lang }).value
    }
    return hljs.highlightAuto(code).value
  },
  langPrefix: 'hljs language-', // 关键修复：添加 hljs 类名前缀
  breaks: true,
  gfm: true
})
// ...
```

这将确保生成的 HTML 类似于 `<pre><code class="hljs language-javascript">...</code></pre>`，从而正确应用 `atom-one-dark.css` 中的样式。
